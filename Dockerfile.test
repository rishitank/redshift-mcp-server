FROM node:22.12.0-alpine

# Install dependencies for test containers
RUN apk add --no-cache \
    docker-cli \
    docker-compose \
    postgresql-client

# Set working directory
WORKDIR /app

# Copy package files and configuration
COPY package*.json ./
COPY tsconfig*.json ./
COPY jest.config.ts ./
COPY esbuild.config.ts ./

# Install dependencies
RUN npm ci

# Copy source code
COPY src/ ./src/
COPY tests/ ./tests/

# Build the application
RUN npm run build

# Run tests
CMD ["npm", "test"]
